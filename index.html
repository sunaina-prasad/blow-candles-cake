<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8"/>
<title>Blow to Extinguish Candles</title>

<style>
    body {
        margin:0;
        background:#d8c1b5;
        font-family:sans-serif;
        text-align:center;
        padding-top:20px;
        overflow:hidden;
        user-select:none;
    }

    /* Hidden message before blowing */
    #finalMessage {
        display:none;
        font-size:32px;
        font-weight:bold;
        margin-top:20px;
        color:#000;
        animation: popIn 0.6s ease;
    }

    @keyframes popIn {
        from { transform:scale(0.5); opacity:0; }
        to { transform:scale(1); opacity:1; }
    }

    .cake {
        width:260px;
        height:150px;
        background:#5c2d1f;
        border-radius:100px/40px;
        margin:50px auto 20px;
        position:relative;
    }

    .layer2 {
        position:absolute; bottom:35px;
        width:260px; height:35px;
        background:#d28374;
        border-radius:100px/35px;
    }

    .layer1 {
        position:absolute; bottom:0;
        width:260px; height:35px;
        background:#e9d8c9;
        border-radius:100px/35px;
    }

    .candles {
        width:100%;
        position:absolute;
        top:-30px;
        display:flex;
        justify-content:center;
        gap:10px;
    }

    .candle {
        width:10px;
        height:25px;
        background:#8afcea;
        border-radius:5px;
        position:relative;
    }

    .flame {
        width:8px; height:12px;
        background:radial-gradient(circle,#fff59e 20%, #ffae00 80%);
        border-radius:50%;
        position:absolute;
        top:-14px;
        left:50%;
        transform:translateX(-50%);
        animation:flicker 0.2s infinite alternate;
    }

    @keyframes flicker {
        from { transform:translateX(-50%) scale(1); }
        to { transform:translateX(-52%) scale(0.8); }
    }

    .smoke {
        width:6px; height:10px;
        background:rgba(180,180,180,0.5);
        border-radius:50%;
        position:absolute;
        top:-14px;
        left:50%;
        transform:translateX(-50%);
        opacity:0;
        animation:smokeUp 1s infinite;
    }

    @keyframes smokeUp {
        from { transform:translate(-50%,0); opacity:0.5; }
        to { transform:translate(-50%,-18px); opacity:0; }
    }

    button {
        padding:12px 20px;
        background:#fc7da8;
        color:white;
        border:none;
        border-radius:30px;
        font-size:16px;
    }

    /* Fireworks Canvas */
    #fireworksCanvas {
        position:fixed;
        top:0; left:0;
        width:100vw;
        height:100vh;
        pointer-events:none;
        display:none;
    }
</style>
</head>

<body>

<!-- Hidden final message -->
<div id="finalMessage">ðŸŽ‰ Many Many Returns of the Day ðŸ¥³ ðŸŽ‰</div>

<!-- Cake -->
<div class="cake">
    <div class="layer2"></div>
    <div class="layer1"></div>
    <div class="candles" id="candleRow"></div>
</div>

<button onclick="startMic()">Enable Microphone ðŸŽ¤</button>

<!-- Fireworks Canvas -->
<canvas id="fireworksCanvas"></canvas>

<script>
    // Create the candles
    const candleRow = document.getElementById("candleRow");
    for (let i = 0; i < 14; i++) {
        const candle = document.createElement("div");
        candle.className = "candle";

        const flame = document.createElement("div");
        flame.className = "flame";

        const smoke = document.createElement("div");
        smoke.className = "smoke";

        candle.appendChild(flame);
        candle.appendChild(smoke);
        candleRow.appendChild(candle);
    }

    let blown = false;

    function blowOut() {
        if (blown) return;
        blown = true;

        // Flames disappear
        document.querySelectorAll(".flame").forEach(f => f.style.display = "none");
        // Smoke appears
        document.querySelectorAll(".smoke").forEach(s => s.style.opacity = "1");

        // Fireworks + message
        setTimeout(() => {
            document.getElementById("fireworksCanvas").style.display = "block";
            document.getElementById("finalMessage").style.display = "block";
            startFireworks();
        }, 800);
    }

    // Microphone detection
    let audioCtx, analyser, dataArray;

    function startMic() {
        navigator.mediaDevices.getUserMedia({ audio: true })
            .then(stream => {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                analyser = audioCtx.createAnalyser();
                const source = audioCtx.createMediaStreamSource(stream);

                analyser.fftSize = 256;
                dataArray = new Uint8Array(analyser.frequencyBinCount);
                source.connect(analyser);

                detectBlow();
                alert("Microphone ON! Blow to extinguish the candles ðŸŽ¤ðŸ’¨");
            })
            .catch(() => alert("Microphone permission denied."));
    }

    // Detect blowing
    function detectBlow() {
        requestAnimationFrame(detectBlow);
        analyser.getByteFrequencyData(dataArray);

        let volume = dataArray.reduce((a,b)=>a+b) / dataArray.length;

        if (volume > 60) {
            blowOut();
        }
    }

    /* FIREWORKS SYSTEM */
    function startFireworks() {
        const canvas = document.getElementById("fireworksCanvas");
        const ctx = canvas.getContext("2d");

        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        let particles = [];

        function createFirework() {
            const x = Math.random() * canvas.width;
            const y = Math.random() * canvas.height * 0.6;
            const colors = ["#ff595e", "#ffca3a", "#8ac926", "#1982c4", "#6a4c93"];

            for (let i = 0; i < 40; i++) {
                particles.push({
                    x, y,
                    angle: Math.random() * Math.PI * 2,
                    speed: Math.random() * 4 + 2,
                    life: 40,
                    color: colors[Math.floor(Math.random()*colors.length)]
                });
            }
        }

        function animate() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            particles.forEach((p, index) => {
                p.x += Math.cos(p.angle) * p.speed;
                p.y += Math.sin(p.angle) * p.speed;
                p.life--;

                ctx.fillStyle = p.color;
                ctx.beginPath();
                ctx.arc(p.x, p.y, 3, 0, Math.PI * 2);
                ctx.fill();

                if (p.life <= 0) particles.splice(index, 1);
            });

            if (Math.random() < 0.08) createFirework();

            requestAnimationFrame(animate);
        }

        animate();
    }
</script>

</body>
</html>
